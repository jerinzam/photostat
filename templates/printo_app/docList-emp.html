 
{% extends "empMain.html" %}

{% block sub_css %}

	<style type="text/css">
	.navbar{
		box-shadow: 0 0 3px rgba(0,0,0,0.8)
		
	}
	.fixed {
        
        position: fixed;
        width: 200px;
        top:70px;
        margin-left:3.3%;
        /*text-align: right;*/
	}
	.scrollit {

		position: relative;
		width:600px;
		left: 258px;
		padding-top: 45px;
	                
	}

	.fixed1{
		width: 250px;
		position: fixed;
		top:50px;
		right: 140px;

	}
	.he{
		background: #eee;
		padding: 20px;
		padding-bottom: 0px;
		top:10px;
		width:44.35%;
		position: fixed;
		left: 363.5px;
		z-index: 100;
		box-shadow: 0 0 12px rgba(0,0,0,0.2);
		border-bottom: 1px solid #ddd;
		border-radius: 0px !important;
	}
	body { padding-top: 70px; }

	.border{

		/*border:1px solid black;*/
	}

/*===========================================*/

		.border{
			/*border: 1px solid black;*/
		}
		.filter{
			margin-top: 20px;
			padding: 1px !important;
			/*width: 26.5% !important;*/

			/*border:1px solid black;*/
		}

		.date_tabs li a{
			/*color: red;*/
			padding-left: 10px !important;
			padding-right: 11.5px !important;
		}	

		#tags{
		 /* float:left;
		  border:1px solid #ccc;
		  padding:5px;
		  font-family:Arial;*/
		}
		#tags span.tag{
		  cursor:pointer;
		  display:block;
		  float:left;
		  color:#fff;
		  background:#689;
		  padding:5px;
		  padding-right:25px;
		  margin:4px;
		}
		#tags span.tag:hover{
		  opacity:0.7;
		}
		#tags span.tag:after{
		 position:absolute;
		 content:"x";
		 border:1px solid;
		 padding:0 4px;
		 margin:3px 0 10px 5px;
		 font-size:10px;
		}
		#tags input{
		  /*background:#eee;
		  border:0;*/
		  /*margin:4px;*/
		  /*padding:7px;*/
		  /*width:auto;*/
		}

		.panel-title a {
		    display: block;
		    padding: 10px 15px;
		    margin: -10px -15px;
		}

		.doc_details_sub{
		    background: #f8f8f8;
		    padding: 15px;
		    box-shadow: inset 0 5px 7px -5px rgba(0,0,0,0.25),inset 0 -3px 7px -5px rgba(0,0,0,0.25);
		    /*padding-top: 0px !important;*/
		}
		h3{
		    font-size: 20px !important;
		    font-weight: bolder !important;
		}

		.tags_content, .topics_content{
			padding: 5px;
			width: 98%;
			font-size: 12px;
			margin-top:-5px;
		}

		td{
			padding-bottom: 15px !important;
		}

		.date {
		    float: left;
		    margin: -1px 10px 0 -65px;
		    height: 35px;
		    width: 35px;
		    text-align: center;
		    font-size: 10px;
		    text-transform: uppercase;
		    color: #999;
		    font-weight: normal;
		}
		div.main-block {
		    /*cursor: pointer;*/
		    display: inline-block;
		    box-sizing: border-box;
		    -moz-box-sizing: border-box;
		    -webkit-box-sizing: border-box;
		    -ms-box-sizing: border-box;
		    width: 220px;
		    padding: 9px 2px 6px 68px;
		    /*position: relative;*/
		}
		div.number {
		    margin-top: -3px;

		    font-size: 20px;
		}

		div.main-block>.header {
		    font-size: 16px;
		    font-weight: bold;
		    overflow-x: hidden;
		    overflow-y: hidden;
		    height: 40px;
		    margin-top: 0;
		    margin-left: -20px;
		}
		div.main-block>.header .description {
			height: 35px;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    white-space: nowrap;
		    margin-left: 0px;
		    margin-top: 2px;
		    max-width: 200px;
		    min-width: 150px;
		    display: inline-block;
		    padding-bottom: 2px;
		}

		div.cost, div.action {
		    position: relative;
		    cursor: pointer;
		    display: inline-block;
		    white-space: nowrap;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    vertical-align: top;
		    padding: 11px 4px 12px;
		    font-size: 12px;
		    width: 69px;
		    color: #aaa;
		    line-height: 15px;
		}
		div.action{
			margin-top: -5px;
			vertical-align: top;
			margin-left: 8px;
			width: 35px;
		}

		div.cost .negative {
		    color: #ff652f;
		    font-weight: bold;
		    font-size: 16px;
		}

		div.pages, div.type {
		    text-align: right;
		    width: 100px;
		    padding: 11px 10px 12px 5px;
		    font-size: 12px;
		    line-height: 15px;
		    white-space: nowrap;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    display: inline-block;
		    vertical-align: top;
		    color: #aaa;
		    cursor: pointer;
		}
		div.type{
			width: 60px;
		}
		div.pages .number {
		    color: #000;
		    font-weight: bold;
		    font-size: 16px;
		}
		.filesize {
			 color: darkgrey;
		    font-weight: normal !important;
		    font-size: 10px !important;
		}
		div.type .number  {
			 color: darkgrey;
		    font-weight: bold;
		    font-size: 16px;
		}



		div.panel-heading{
			padding: 0px;
			background: white !important;
			
		}

		 a.delete {
		    color: grey;
		    /*background: rgba(249,249,249,0.8);*/

		    /*font-weight: bold;*/
		    font-size: 20px;
		    position: ;
		    /*top: 1px;*/
		    right: 0px;
		    /*padding: 5px;*/
		}
		a.print {
		    color: grey;
		    
		    /*background: rgba(249,249,249,0.8);*/
		    /*font-weight: bold;*/
		    font-size: 15px;
		    position: ;
		    margin-top: -6px;
		    /*right: 10px;*/
		    padding: 8px;
		    /*margin-right: 10px; */
		}

		.print-badge{
			background-color: grey !important;
		}

		.filter_choices {
			background: #5BC5A7;
			margin-top: .5%;
			width:100%;
			margin-bottom: 0px;
			/*border-top: 1px solid lightgrey;*/
			/*border-bottom: 1px solid lightgrey;*/
			padding:3px 0px !important;
			padding-left: 8px !important;
		}
		.filter_choices .btn{
			margin: 4px 2.46px !important;
			/*margin-left: 1px !important;*/
			border: none;
			/*border: 1px solid grey !important;*/
			color: #39A385 !important;
			background: white !important;
			border-radius: 10px !important;
			font-size: 12px !important;
			padding: 5px !important;
		}

		.filter_choices .active{
			/*border: 1px solid grey !important;*/
			color: white !important;
			background:#FF652F !important;
		}

		.filter .mainbtn{
			background: #9ED7C7;
			color: #8EC2B3;
			
			border: 1px solid lightgrey;
			margin: 0px !important;
			border-radius: 0px !important;
			
			width: 50%;

		}

		.filter .mainbtn .active{
			background: #5BC5A7;
			color:white;
		}
		.mainbtn_container{

			padding: 0px;
			width: 100%
		}
		.newsbtn{
			/*border-left: px solid white !important;*/
		}
		.searchbtn{
			border-right: 1px solid white !important;
		}

		.class_search_body{
			padding: 20px 2px !important;
			margin-top: -18.8px;
			background: #5BC5A7;
		}

		.doc_details_sub td h3{

			padding-top:7px;
			margin-top: 0px;

		}
		.class_accordian_table {
		 border-collapse: collapse;
		}
		.class_accordian_table tr  { 
		  border-bottom: 1px solid lightgrey;
		}
		.class_accordian_table tr:first-child {
		  border-top: none;
		}
		.class_accordian_table tr:last-child {
		  border-bottom: none;
		}

		.right_top_btns, .left_top_btns{
			height: 50px;
		}


		 #view_links a {
		    color: inherit;
		    display: block;
		    height: 30px;
		    font-size: 14px;
		    /*overflow: hidden;*/
		    /*white-space: nowrap;*/
		    /*text-overflow: ellipsis;*/
		    padding: 3px 8px 2px 8px !important;
		    text-decoration: none;
		    border-left: 6px solid #fff;
		}

		#view_links {
		    text-align: left;
		    width: 200px;
		    margin-left: 2px;
		    /*overflow: hidden;*/
		    /*white-space: nowrap;*/
		    /*text-overflow: ellipsis;*/
		}

		#left_sidebar .header {
			width: 100%;
		    position: relative;
		    /*margin-left: 5px;*/
		    background: #5BC5A7;
		    color: white;
		    font-size: 11px;
		    margin-top: 5px;
		    border-top: 1px solid #f3f3f3;
		    border-bottom: 1px solid #eee;
		    text-transform: uppercase;
		    padding: 5 5px;
		}

		

		#center_column{
			padding: 0px;
			
		}
		#center_column{
			box-shadow: 0 0 12px rgba(0,0,0,0.2);
		}
		.panel{
			padding-top: 0px !important;
			margin-top: 0px !important;
			border-radius: 0px !important;
		}


	</style>

{% endblock %}

{% block emp-content %}

	  

		<h2 class="he border page-header">My Documents</h2><br>
		<div class="scrollit border">
			<div id="center_column" class="col-md-12 border">
				

				<div class="panel-group class_doc_list" id="accordion" role="tablist" aria-multiselectable="true">
				</div>
			</div>	      
	    </div>


	    <div class="fixed1 border">
         	<div id="right_sidebar" class="col-md-12 border">
 				<div class="right_top_btns">
 				</div>
				<div class="filter border">
					<div class=" btn-group mainbtn_container">
						<button class="btn btn-lg searchbtn mainbtn ">Search</button>
						<button class=" btn btn-lg newsbtn mainbtn">News</button>
					</div>
				
					<div class="btn-group filter_choices" data-toggle="buttons">
						  <label class="btn btn-primary  btn-sm namebtn ">
						    <input type="radio" name="options" id="id_namebtn" autocomplete="off" checked> name
						  </label>
						  <label class="btn btn-primary btn-sm datebtn">
						    <input type="radio" name="options" id="option2" autocomplete="off"> date
						  </label>
						  <label class="btn btn-primary btn-sm pricebtn">
						    <input type="radio" name="options" id="option3" autocomplete="off"> price
						  </label>

						  <label class="btn btn-primary btn-sm tagsbtn">
						    <input type="radio" name="options" id="option3" autocomplete="off"> tags
						  </label><label class="btn btn-primary btn-sm topicsbtn">
						    <input type="radio" name="options" id="option3" autocomplete="off"> topic
						  </label>
					</div>
					<br><br>
					<div id="search_body" class="class_search_body container col-sm-12">

						<div id="name_search" class="col-sm-12 " style="display: none;">

							<label for="id_name_search">Search by File Name:</label> 
			          		<input id="id_name_search" class="form-control" name="name_search" type="text" />
			          		<br>
						</div>
						<div id="date_search" class="col-sm-12 " style="display: none;">

							<label for="id_nearest_college">Search by Date:</label> 
							<ul class="nav nav-tabs date_tabs">
								  <li role="presentation" class="active"><a href="#on_date">on</a></li>
								  <li role="presentation"><a href="#before_date">before</a></li>
								  <li role="presentation"><a href="#after_date">after</a></li>
								  <li role="presentation"><a href="#between_date">between</a></li>

							</ul>
							<div class="tab-content">
							    <div role="tabpanel" class="tab-pane active" id="on_date">
							    	<br>
							    	<label for="id_on_date_search">File uploaded on:</label> 
							    	<input id="id_on_date_search" class="form-control datepicker" name="on_input" type="text" />
							    </div>
							    <div role="tabpanel" class="tab-pane" id="before_date">
							    	<br>
							    	<label for="id_before_date_search">File uploaded before:</label> 
							    	
							    	<input id="id_before_date_search" name="before_input" type="text" class=" form-control datepicker"></p>
							    </div>
							    <div role="tabpanel" class="tab-pane" id="between_date">
							    	<br>
							    	<label for="id_between_date_search">File uploaded between:</label> 
							    	<input id="id_start_between_date_search" class="form-control  datepicker" name="nearest_college" type="text" /><br>
							    	and <br><br>
							    	<input id="id_end_between_date_search" class="form-control  datepicker" name="nearest_college" type="text" />
							    </div>
							    <div role="tabpanel" class="tab-pane" id="after_date">
							    	<br>
							    	<label for="id_after_date_search">File uploaded after:</label> 
							    	<input id="id_after_date_search" class="form-control datepicker" name="after_input" type="text" />
							    </div>
						  	</div>
							
							<br><br>
			          		
			          		<br>
						</div> <!-- end date_search -->
						<br>
						<div id="price_search" class="col-sm-12 " style="display: none;">
							<div class="row">
								<div class="col-md-4">
									<input class="form-control" id="id_price_min" value="" disabled/>
								</div>
								<div class="col-md-4 pull-right">
									<input  class="form-control" id="id_price_max" value="" disabled/>
								</div>
							</div>
							<br>
							<div id="range"></div>
							<br>
							<br>
							<br>
						</div> <!-- end price_search -->
						<div id="type_search" class="col-sm-12 " style="display: none;">
								this is type
						</div> <!-- end tags_search -->
						<div id="tags_search" style="display: none;">
								<div id="tags" class="col-sm-12 ">
						        	<label for="id_tags_proxy">Tags:</label> 
						        	<input  class="form-control" type="text" multiple="multiple" id="id_tags_proxy" />
						        </div>
						</div> <!-- end tags_search -->
						<div id="topics_search" class="col-sm-12 " style="display: none;">
								this is topics
						</div> <!-- end tags_search -->
					</div> <!-- end search_body -->
				</div>
			</div>
	    </div>



{% endblock %}



{% block javascript %}
	{% load staticfiles %}
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="{% static 'js/printo_app/nouislider.min.js' %}"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script type="text/javascript">
		var monthNames = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];



		// 

		var slider = document.getElementById('range');

		noUiSlider.create(slider, {
			start: [ 20, 80 ], // Handle start position
			step:40, // Slider moves in increments of '10'
			margin: 20, // Handles must be more than '20' apart
			connect: true, // Display a colored bar between the handles
			direction: 'ltr', // Put '0' at the bottom of the slider
			orientation: 'horizontal', // Orient the slider vertically
			behaviour: 'tap-drag', // Move handle on tap, bar is draggable
			range: { // Slider can select '0' to '100'
				'min': 0,
				'max': 500
			},
			pips: { // Show a scale with the slider
				mode: 'steps',
				density: 10
			}

		});

		// 


		var x = {}
		var displayDocs = {}
		
		var i = 0
		var text = ''
		{% for item in docs %}

		var tags_store = []
			{% for tag in item.tags.all %}
	 				tags_store.push('{{tag.name}}')
			{% endfor%}
			
			 x[i] = {
			 			id:'{{item.id}}',
			 			name:'{{item.name}}',
			 			uploadedDate:'{{item.uploadedDate|date:"SHORT_DATE_FORMAT"}}',
			 			price:'{{item.price}}',
			 			tags : tags_store,
			 			doc_url :'{{item.display_doc}}',
			 			pages:'{{item.pages}}', 
			 		}	
			console.log('{{item.display_doc}}')
			 i = i + 1
		{% endfor %}

		

		i=0
		$.each(x,function(index,value){
			console.log(value["tags"])
			displayDocs[i] = {
								name:value["name"],
								id:value["id"],
								uploadedDate:value['uploadedDate'],
								price:value['price'],
								tags:value['tags'],
								doc_url:value['doc_url'],
								pages:value['pages']
							}
			i=i+1
		})


		function new_display(id){
			
			$(".panel").filter(function(i){
			    return $.inArray( $(this).attr('id').substring(4),id) != -1;
			}).closest('.panel').show();
		}

		// start - search by name
		$('#id_name_search').on('input',function(){
			var id = []
			$('.panel').hide();
			var that = this
			$.each(x,function(index,value){
			 	
				if(value["name"].toLowerCase().indexOf(that.value.toLowerCase()) != -1){

					id.push(value["id"]) 
				}
			})

			new_display(id)
		})
		// stop - search by name

		$('#id_on_date_search').on('change',function(){
			var id = []
			$('.panel').hide();
			var that = this
			$.each(x,function(index,value){
			 	// alert(new Date(value["uploadedDate"]) <= new Date(that.value))
				if((value["uploadedDate"] === that.value)){

					id.push(value["id"]) 
				}
			})
			new_display(id)
		})

		$('#id_before_date_search').on('change',function(){
			var id = []
			$('.panel').hide();
			var that = this
			$.each(x,function(index,value){
			 	// alert(new Date(value["uploadedDate"]) <= new Date(that.value))
				if(new Date(value["uploadedDate"]) < new Date(that.value)){

					id.push(value["id"]) 
				}
			})
			new_display(id)
		})

		$('#id_after_date_search').on('change',function(){
			var id = []
			$('.panel').hide();
			var that = this
			$.each(x,function(index,value){
			 	// alert(new Date(value["uploadedDate"]) <= new Date(that.value))
				if(new Date(value["uploadedDate"]) > new Date(that.value)){

					id.push(value["id"]) 
				}
			})
			new_display(id)
		})

		$('#id_end_between_date_search').on('change',function(){
			var id = []
			$('.panel').hide();
			var that = this
			$.each(x,function(index,value){
			 	// alert($('#id_start_between_date_search').val())
				if((new Date(value["uploadedDate"]) <= new Date(that.value) )&&(new Date(value["uploadedDate"]) >= new Date($('#id_start_between_date_search').val()) )  ){
					
					id.push(value["id"]) 
				}
			})
			new_display(id)
		})

		slider.noUiSlider.on('update', function( values, handle ) {
			if ( handle ) {
				$('#id_price_max').val(values[handle])
			} else {
				$('#id_price_min').val(values[handle])
			}
		
			var id = []
			$('.panel').hide();
			var that = this
			$.each(x,function(index,value){
				if( ( parseInt(value["price"])  <= $('#id_price_max').val() ) && (parseInt(value["price"] ) >= $('#id_price_min').val()) ){
					
					id.push(value["id"]) 
				}
			})
			new_display(id)
		})

		var date = new Date()

		// start -> creating the html for PANEL
		$.each(displayDocs,function(index,value){
			console.log(value["uploadedDate"],"-")
			text = text + ('<div class="panel panel-default" id="file'+ value["id"] +'"  > <div class="panel-heading" role="tab" id="heading'+ value["id"] +'">')
			text = text + '<div class="main-block border">'
			text = text + '<div class="date border">'+monthNames[new Date(value["uploadedDate"]).getMonth()].substring(0,3)+'<div class="number">'+new Date(value["uploadedDate"]).getDate()+'</div></div>'
			// text = text + '<h4 class="panel-title">'
			text = text + '<div class="header border" data-toggle="collapse" data-parent="#accordion" data-target="#collapse-'+ value["id"] +'" aria-expanded="false" ><span class="description border">'+ value["name"] +'<br><span class="filesize">27.5 MB</span></span></div>'
			// text = text + '<br>'
			// text = text + '<a role="button" id="file'+ value["id"] +'" data-toggle="collapse" data-parent="#accordion" href="#collapse-'+ value["id"] +'" aria-expanded="false" aria-controls="collapse-'+ value["id"] +'">'+ value["name"] +'</a>'
			// text = text + '</h4>'

			// /static/js/printo_app/pdfjs-1.1.215-dist/web/viewer.html?file=/static/compressed.tracemonkey-pldi-09.pdf
			text = text + '</div>' // end - main-block

			text = text + '<div class="type">Type <br><span class="number">Notes</span></div>'
			text = text + '<div class="pages">Pages <br><span class="number">'+ value["pages"] +'</span></div>'
			text = text + '<div class="cost border">Cost <br><span class="negative">'+ value["price"] +'</span></div>'
			text = text + '<div class="action border"><br><a href="/static/js/printo_app/pdfjs-1.1.215-dist/web/viewer.html?file=/static/'+value["doc_url"].split("/")[1]+'" class=" badge print-badge print pdf_view"><span class="glyphicon glyphicon-eye-open "></span></a></div>'
			text = text + '<div class="action border"><br><a href="#" class=" badge print-badge print"><span class="glyphicon glyphicon-print"></span></a></div>'
			text = text + '<div class="action border"><br><a href="#" class="delete">x</a></div>'		
			text = text + '</div>'
			text = text + '<div id="collapse-'+ value["id"] +'" class="panel-collapse collapse " role="tabpanel" aria-labelledby="heading'+ value["id"] +'">'
			text = text + '<div class="panel-body doc_details_sub" style="display:block;">'
			text = text + '<table class="col-md-12 class_accordian_table"><tbody>'
			text = text + '<tr>'
			text = text + '<td class="border"><h3>University</h3>'
			text = text + '<div class="tags_content border ">'+"Kerala University"+'</div>'
			text = text + '</td>'
			text = text + '<td class="border"><h3>College</h3>'
			text = text + '<div class="tags_content border ">'+"T.K.M College of engineering" +'</div>'
			text = text + '</td>'
			text = text + '<td class="border"><h3>Author</h3>'
			text = text + '<div class="tags_content border ">'+"O.P Khanna"+'</div>'
			text = text + '</td>'
			text = text + '<td class="border"><h3>Subject</h3>'
			text = text + '<div class="tags_content border ">'+"solid state devices" +'</div>'
			text = text + '</td>'
			text = text + '</tr>'
			text = text + '<tr ><td class="" colspan="2"><h3>Tags</h3>'
			text = text + '<div class="tags_content border ">'+value["tags"] +'</div>'
			text = text + '</td>'
			text = text + '<td class="" colspan="2"><h3>Topics</h3><div class="topics_content">'+value["tags"] +'</div>'
			text = text + '</td>'
			text = text + '</tr></tbody></table>'
			text = text + '</div>'						       
			text = text + '</div></div>'
		})
		// stop -> creating the html for PANEL


		$('.class_doc_list').html(text)

		$(function() {


		// ============= start - pdf viewer =============================

			$('.pdf_view').click(function(e){
			
				console.log('yuppppppppp')
			})


		// ============= stop - pdf viewer ============================
				
			$( ".datepicker" ).datepicker();

			$('.date_tabs a').click(function (e) {
			  e.preventDefault()
			  $(this).tab('show')
			})
			// $('#search_body > div').hide()

			$('.namebtn').click(function(){
				$('#name_search').show()
				$('#name_search').siblings().hide();

			})

			$('.datebtn').click(function(){

				$('#date_search').show()
				$('#date_search').siblings().hide()

			})

			$('.pricebtn').click(function(){

				$('#price_search').show()
				$('#price_search').siblings().hide()

			})

			$('.typebtn').click(function(){

				$('#type_search').show()
				$('#type_search').siblings().hide()

			})

			$('.tagsbtn').click(function(){

				$('#tags_search').show()
				$('#tags_search').siblings().hide()

			})

			$('.topicsbtn').click(function(){

				$('#topics_search').show()
				$('#topics_search').siblings().hide()

			})
		})

		function extractLast( term ) {
		  return split( term ).pop();
		}

		function split( val ) {
		  return val.split( /,\s*/ );
		}    

		var terms = []
	    var keys_final = []
	    var keys = [];
	    $.getJSON("/printo-app/get_tags/", function (dictionary) {
	        



	        for (var key in dictionary) {
	          if (dictionary.hasOwnProperty(key)) {
	            keys.push(key.toLowerCase());
	          }
	        }
	        
	        $( "#id_tags_proxy" )
	        .bind( "keydown", function( event ) {
	        	// start - removing already entered value from the dropdown source
	        	keys_final = []
	        	keys.filter(function(n) {
						// alert(terms_array.indexOf(n) != -1)
				    if( terms.indexOf(n) == -1 ){
				    	keys_final.push(n) 
				    }
				})
				// end - removing already entered value from the dropdown source

	          if ( event.keyCode === $.ui.keyCode.TAB &&
	              $( this ).autocomplete( "instance" ).menu.active ) {

	            event.preventDefault();

	          }

	        })
	        .autocomplete({
	           source: function( request, response ) {
	          // delegate back to autocomplete, but extract the last term
	          response( $.ui.autocomplete.filter(
	            keys_final, extractLast( request.term ) ) );
	          },
	          focus: function() {
	            // prevent value inserted on focus
	            return false;
	          },
	          select: function( event, ui ) {
	          	terms = terms

	           
		      	terms.push( ui.item.value.toLowerCase()  );
		      	terms_array = terms
			      
		      	// terms.push( "" );
		      	$(this).after('<span class="tag">'+ ui.item.value.toLowerCase() +'</span>');
			      // this.value = terms.join( ", " );
	      		this.value = ''
	             // ==============================================
	          	var id = []
				$('.panel').hide();
				var that = this
				$.each(x,function(index,value){

					value["tags"].filter(function(n) {
						// alert(terms_array.indexOf(n) != -1)
				    if( terms.indexOf(n.toLowerCase()) != -1 ){
				    	id.push(value["id"]) 
				    }
				});

				})
				new_display(id)
				// ===============================================


	              return false;
	          }
	        }); 
	    });
		$('#tags').on('click','.tag',function(){
			
	     if(confirm("Really delete this tag?")) {

	     	$(this).remove(); 
	     	
	     	terms.splice(terms.indexOf($(this).text()),1)	
	     }

	     	var id = []
				$('.panel').hide();
				var that = this
				$.each(x,function(index,value){

					value["tags"].filter(function(n) {
						// alert(terms_array.indexOf(n) != -1)
				    if( terms.indexOf(n.toLowerCase()) != -1 || terms.length == 0){
				    	id.push(value["id"]) 
				    }
				});

				})
			new_display(id)

	  });
	</script>

{% endblock %}